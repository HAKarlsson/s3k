# See LICENSE file for copyright and license details.
capabilities:
  - name: Time
    fields:
      hartid: 8
      begin: 12
      free: 12
      end: 12
  - name: Memory
    fields:
      begin: 16
      free: 16
      end: 16
      offset: 6
      rwx: 3
      lock: 1
  - name: Pmp
    fields:
      addr: 48
      cfg: 5
  - name: Monitor
    fields:
      begin: 12
      free: 12
      end: 12
  - name: Channel
    fields:
      begin: 12
      free: 12
      end: 12
  - name: Socket
    fields: 
      port: 12
      tag: 12

predicates:
  - name: TimeIsChild 
    cases:
      - parent: Time
        child: Time
        conditions:
          - p.hartid == c.hartid
          - p.begin <= c.begin
          - c.end <= p.free
  - name: MemoryIsChild 
    cases:
      - parent: Memory
        child: Memory
        conditions:
        - p.begin <= c.begin
        - c.end <= p.free
  - name: MonitorIsChild
    cases:
      - parent: Monitor
        child: Monitor
        conditions:
        - p.begin <= c.begin
        - c.end <= p.free
  - name: ChannelIsChild
    cases:
      - parent: Channel
        child: Channel
        conditions:
          - p.begin <= c.begin
          - c.end < p.free
      - parent: Channel
        child: Socket
        conditions:
          - p.begin <= c.port
          - c.port < p.free
  - name: SocketIsChild
    cases:
      - parent: Socket
        child: Socket
        conditions:
          - p.port == c.port
          - p.tag == 0

  - name: TimeCanDerive
    cases:
      - parent: Time
        child: Time
        conditions:
          - p.hartid == c.hartid
          - p.free == c.begin
          - c.end <= p.end
          - c.free == c.begin
          - c.begin <= c.end
  - name: MemoryCanDerive
    cases:
      - parent: Memory
        child: Memory
        conditions:
          - p.lock == 0
          - c.lock == 0
          - p.free == c.begin
          - c.end <= p.end
          - (c.rwx & p.rwx) == c.rwx
          - c.free == c.begin
          - c.begin <= c.end
  - name: MonitorCanDerive
    cases:
      - parent: Monitor
        child: Monitor
        conditions:
          - p.free == c.begin
          - c.end <= p.end
          - c.free == c.begin
          - c.begin < c.end
  - name: ChannelCanDerive
    cases:
      - parent: Channel
        child: Channel
        conditions:
          - p.free == c.begin
          - c.end <= p.end
          - c.free == c.begin
          - c.begin < c.end
      - parent: Channel
        child: Socket
        conditions:
          - p.free <= c.port
          - c.port < p.end
          - c.port == 0
  - name: SocketCanDerive
    cases:
      - parent: Socket
        child: Socket
        conditions:
          - p.port == c.port
          - p.tag == 0
          - 0 < c.tag
